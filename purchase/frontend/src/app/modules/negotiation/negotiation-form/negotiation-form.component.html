<div class="container mt-4">
  <!-- Header -->
  <div class="row mb-4">
    <div class="col-12">
      <h2>
        <i class="bi bi-chat-dots text-warning"></i>
        {{ isViewMode ? 'View Negotiation' : (isEditMode ? 'Edit Negotiation' : 'New Negotiation') }}
      </h2>
      <p class="text-muted">{{ isViewMode ? 'View' : (isEditMode ? 'Update' : 'Create') }} negotiation details</p>
    </div>
  </div>

  <!-- Form -->
  <div class="card shadow-sm">
    <div class="card-body">
      <form #negotiationForm="ngForm" (ngSubmit)="onSubmit()">
        <div class="row">
          <!-- Event ID - HIDDEN -->
          <div class="col-md-6 mb-3" style="display: none;">
            <label for="eventid" class="form-label">Event ID</label>
            <input type="number" class="form-control" id="eventid" name="eventid" [(ngModel)]="negotiation.eventid"
              [readonly]="true">
          </div>

          <!-- Event Name -->
          <div class="col-md-6 mb-3">
            <label for="eventname" class="form-label">
              Name of training <span class="text-danger" *ngIf="!isViewMode">*</span>
            </label>
            <input type="text" class="form-control" id="eventname" name="eventname" [(ngModel)]="negotiation.eventname"
              [required]="!isViewMode" minlength="2" maxlength="100" placeholder="Enter event name"
              [readonly]="isEditMode || isViewMode">
          </div>

          <!-- Vendor ID - HIDDEN -->
          <div class="col-md-6 mb-3" style="display: none;">
            <label for="vendorid" class="form-label">Vendor ID</label>
            <input type="number" class="form-control" id="vendorid" name="vendorid" [(ngModel)]="negotiation.vendorid"
              [readonly]="true">
          </div>

          <!-- Vendor Name -->
          <div class="col-md-6 mb-3">
            <label for="vendorname" class="form-label">
              <i class="bi bi-building me-1"></i>Vendor Name <span class="text-danger" *ngIf="!isViewMode">*</span>
            </label>
            <input type="text" class="form-control" id="vendorname" name="vendorname"
              [(ngModel)]="negotiation.vendorname" [required]="!isViewMode" minlength="2" maxlength="100"
              placeholder="Enter vendor name" [readonly]="isEditMode || isViewMode">
          </div>

          <!-- CDSID -->
          <div class="col-md-6 mb-3">
            <label for="cdsid" class="form-label">
              Requested by <span class="text-danger" *ngIf="!isViewMode">*</span>
            </label>
            <input type="text" class="form-control" id="cdsid" name="cdsid" [(ngModel)]="negotiation.cdsid"
              [required]="!isViewMode" minlength="2" maxlength="50" placeholder="Enter CDSID (e.g., AB12, USER001)"
              [readonly]="isEditMode || isViewMode">
          </div>

          <!-- Negotiation Date -->
          <div class="col-md-6 mb-3">
            <label for="negotiationdate" class="form-label">
              Negotiation Date <span class="text-danger" *ngIf="!isViewMode">*</span>
            </label>
            <input type="date" class="form-control" id="negotiationdate" name="negotiationdate"
              [(ngModel)]="negotiation.negotiationdate" [required]="!isViewMode"  [max]="todayDate" [readonly]="isViewMode">
          </div>

          <!-- Initial Quote Amount -->
          <div class="col-md-6 mb-3">
            <label for="initialquoteamount" class="form-label">
              Initial Quote Amount (₹) <span class="text-danger" *ngIf="!isViewMode">*</span>
            </label>
            <input type="number" class="form-control" id="initialquoteamount" name="initialquoteamount"
              [(ngModel)]="negotiation.initialquoteamount" [required]="!isViewMode" min="0" step="0.01"
              [readonly]="isEditMode || isViewMode">
          </div>

          <!-- Final Amount -->
          <div class="col-md-6 mb-3">
            <label for="finalamount" class="form-label">
              Final Amount (₹) <span class="text-danger" *ngIf="!isViewMode">*</span>
            </label>
            <input type="number" class="form-control" id="finalamount" name="finalamount"
              [(ngModel)]="negotiation.finalamount" [required]="!isViewMode" min="0" step="0.01"
              [readonly]="isViewMode">
          </div>

          <!-- Savings Display -->
          <div class="col-md-6 mb-3">
            <label class="form-label">Savings (₹)</label>
            <div class="form-control bg-light" style="font-weight: bold; color: green;">
              {{ calculateSavings() | number: '1.2-2' }}
            </div>
          </div>

          <!-- Status -->
          <div class="col-md-6 mb-3">
            <label for="negotiationstatus" class="form-label">
              Status <span class="text-danger" *ngIf="!isViewMode">*</span>
            </label>
            <select class="form-select" id="negotiationstatus" name="negotiationstatus"
              [(ngModel)]="negotiation.negotiationstatus" [required]="!isViewMode" [disabled]="isViewMode">
              <option *ngFor="let status of statusOptions" [value]="status">
                {{ status }}
              </option>
            </select>
          </div>

          <!-- UPDATED: Purchase Request Number -->
          <div class="col-md-6 mb-3">
            <label for="prNumber" class="form-label">
              Purchase Request Number
            </label>
            <input type="number" class="form-control" id="prNumber" name="prNumber" [(ngModel)]="negotiation.prNumber"
              min="1" placeholder="Enter Purchase Request Number (Optional)" [readonly]="isEditMode || isViewMode">
            <small class="text-muted">Link to existing Purchase Request</small>
          </div>

          <!-- Notes -->
          <div class="col-12 mb-3">
            <label for="notes" class="form-label">Notes</label>
            <textarea class="form-control" id="notes" name="notes" [(ngModel)]="negotiation.notes" rows="3"
              placeholder="Enter any additional notes..." [readonly]="isViewMode"></textarea>
          </div>
        </div>

        <!-- Buttons -->
        <div class="row mt-3">
          <div class="col-12">
            <!-- Submit Button (Hidden in View Mode) -->
            <button *ngIf="!isViewMode" type="submit" class="btn btn-warning btn-lg me-2"
              [disabled]="!negotiationForm.valid">
              <i class="bi bi-check-circle me-2"></i>
              {{ isEditMode ? 'Update' : 'Create' }}
            </button>

            <!-- Back Button -->
            <button type="button" class="btn btn-secondary btn-lg" (click)="goBack()">
              <i class="bi bi-x-circle me-2"></i>
              {{ isViewMode ? 'Close' : 'Cancel' }}
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>